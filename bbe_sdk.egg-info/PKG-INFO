Metadata-Version: 2.4
Name: bbe_sdk
Version: 0.1.0
Summary: Black Box Evaluation SDK for remote ML model evaluation
Author-email: Iñaki Llorens <llorensinaki22@gmail.com>
License: MIT License
        
        Copyright (c) 2025 Iñaki Llorens
        
        Permission is hereby granted, free of charge, to any person obtaining a copy
        of this software and associated documentation files (the "Software"), to deal
        in the Software without restriction, including without limitation the rights
        to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
        copies of the Software, and to permit persons to whom the Software is
        furnished to do so, subject to the following conditions:
        
        The above copyright notice and this permission notice shall be included in all
        copies or substantial portions of the Software.
        
        THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
        IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
        FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
        AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
        LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
        OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
        SOFTWARE.
        
Project-URL: Homepage, https://github.com/tu-org/bbe-sdk
Project-URL: Repository, https://github.com/tu-org/bbe-sdk
Project-URL: Issues, https://github.com/tu-org/bbe-sdk/issues
Keywords: machine-learning,evaluation,grpc,rabbitmq,SDK,black-box,metrology
Classifier: Development Status :: 4 - Beta
Classifier: Intended Audience :: Developers
Classifier: Programming Language :: Python :: 3
Classifier: Programming Language :: Python :: 3.8
Classifier: Programming Language :: Python :: 3.9
Classifier: Programming Language :: Python :: 3.10
Classifier: Programming Language :: Python :: 3.11
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Classifier: Topic :: Scientific/Engineering :: Artificial Intelligence
Classifier: Topic :: Software Development :: Libraries :: Python Modules
Requires-Python: >=3.8
Description-Content-Type: text/markdown
License-File: LICENSE
Requires-Dist: numpy>=1.21.0
Requires-Dist: protobuf>=3.20.0
Requires-Dist: grpcio>=1.50.0
Requires-Dist: pika>=1.3.0
Requires-Dist: requests>=2.28.0
Requires-Dist: pydantic>=1.10.0
Provides-Extra: dev
Requires-Dist: pytest>=7.0.0; extra == "dev"
Requires-Dist: pytest-asyncio>=0.21.0; extra == "dev"
Requires-Dist: pytest-cov>=4.0.0; extra == "dev"
Requires-Dist: pytest-mock>=3.10.0; extra == "dev"
Requires-Dist: black>=22.0.0; extra == "dev"
Requires-Dist: flake8>=5.0.0; extra == "dev"
Requires-Dist: mypy>=1.0.0; extra == "dev"
Requires-Dist: sphinx>=5.0.0; extra == "dev"
Requires-Dist: sphinx-rtd-theme>=1.0.0; extra == "dev"
Requires-Dist: build>=0.8.0; extra == "dev"
Requires-Dist: twine>=4.0.0; extra == "dev"
Dynamic: license-file

# Black Box Evaluation SDK (BBE SDK)

SDK de evaluación black-box para modelos ML. Permite consumir batches de datos por medio de colas de RabbitMQ y enviar las predicciones al servicio de calibración.

## Características

- ✅ **Evaluación en modalidad caja negra**: No requiere acceso al código fuente del modelo
- ✅ **Soporte multi-modelo**: MNIST, ACDC y fácil extensión a nuevos modelos
- ✅ **Parsing dinámico**: Adaptación automática según el formato de entrada del modelo
- ✅ **Conversión automática**: HWC → CHW para modelos PyTorch
- ✅ **Autenticación robusta**: Sistema de tokens SHA256 con validación
- ✅ **Logging estructurado**: Trazabilidad completa de operaciones
- ✅ **Manejo de errores**: Recuperación automática y mensajes informativos

## Instalación

### Desde repositorio privado GitHub con Personal Access Token

```bash
# Configurar variables de entorno (opcional)
export GITHUB_TOKEN="ghp_xxxxxxxxxxxxxxxxxxxx"
export GITHUB_USER="tu-usuario-github"

# Instalar la SDK
pip install "git+https://${GITHUB_TOKEN}@github.com/tu-org/bbe-sdk.git@v0.1.0"
```

**O directamente con el token en la URL:**

```bash
pip install "git+https://ghp_xxxxxxxxxxxxxxxxxxxx@github.com/tu-org/bbe-sdk.git@v0.1.0"
```

### Instalación de versión específica

```bash
# Instalar versión específica usando tags
pip install "git+https://${GITHUB_TOKEN}@github.com/tu-org/bbe-sdk.git@v1.2.0"

# Instalar desde branch específico
pip install "git+https://${GITHUB_TOKEN}@github.com/tu-org/bbe-sdk.git@main"
```

## Uso Básico

```python
import torch
from bbe_sdk import BlackBoxSession
from your_model import YourModel

# 1. Cargar tu modelo local
model = YourModel()
model.load_state_dict(torch.load("model_weights.pt"))
model.eval()

# 2. Crear función de evaluación
def eval_input_batch(batch_data):
    with torch.no_grad():
        logits = model(torch.tensor(batch_data, dtype=torch.float32))
        probs = torch.softmax(logits, dim=1)
    return probs.numpy()

# 3. Iniciar sesión de evaluación
session = BlackBoxSession(
    eval_input_batch=eval_input_batch,
    token="tu-token-de-autenticacion",
    client_id="tu-client-id"
)

# 4. La sesión comenzará automáticamente a procesar datos
# El SDK manejará toda la comunicación con los servicios backend
```

## Configuración

### Variables de Entorno

```bash
# Configuración de RabbitMQ (opcional, usa valores por defecto)
export RABBITMQ_HOST="rabbitmq"
export RABBITMQ_PORT="5672"

# Nivel de logging
export LOGGING_LEVEL="INFO"
```

### Modelos Soportados

| Modelo | Dataset | Input Format  | Output Format |
| ------ | ------- | ------------- | ------------- |
| MNIST  | MNIST   | (28, 28, 1)   | (10,)         |
| ACDC   | ACDC    | (224, 224, 3) | (10,)         |

## Autenticación

La SDK utiliza un sistema de tokens SHA256 para autenticación:

1. **Registro**: Un administrador debe registrar tu usuario en el sistema
2. **Token**: Se genera un token único con permisos específicos
3. **Validación**: La SDK valida automáticamente el token al conectarse

## Arquitectura

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Tu Modelo     │    │   BBE SDK       │    │   Servicios     │
│   (Local)       │◄───┤   (Python)      │◄───┤   Backend       │
│                 │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## Troubleshooting

### Error de autenticación

```bash
InvalidTokenError: Token validation failed: not authorized.
```

**Solución**: Verificar que el token sea válido y no haya expirado.

### Error de formato de datos

```bash
ValueError: Data size incompatible with expected format
```

**Solución**: Verificar que el `inputs_format` del usuario coincida con el formato esperado por tu modelo.

### Error de conexión RabbitMQ

```bash
Failed to connect to RabbitMQ
```

**Solución**: Verificar que los servicios backend estén ejecutándose y accesibles.

## Desarrollo

### Estructura del Proyecto

```
bbe-sdk/
├── bbe_sdk/
│   ├── __init__.py
│   ├── session.py          # Clase principal BlackBoxSession
│   ├── middleware/         # Abstracción RabbitMQ
│   ├── utils/              # Utilidades (config, logging, data)
│   ├── proto/              # Protocol Buffers
│   └── pb/                 # Generated protobuf code
├── tests/                  # Tests unitarios e integración
├── pyproject.toml          # Configuración del paquete
├── requirements.txt        # Dependencias de producción
├── requirements-dev.txt    # Dependencias de desarrollo
├── pytest.ini             # Configuración de pytest
├── Makefile               # Comandos de desarrollo
└── README.md              # Este archivo
```

### Instalación para Desarrollo

```bash
# Clonar el repositorio
git clone https://github.com/tu-org/bbe-sdk.git
cd bbe-sdk

# Instalar en modo desarrollo
make install-dev

# O manualmente
pip install -e ".[dev]"
```

### Comandos de Desarrollo

```bash
# Ejecutar tests
make test

# Tests con cobertura
make test-cov

# Linting y type checking
make lint

# Formatear código
make format

# Limpiar archivos temporales
make clean

# Construir el paquete
make build

# Ver todos los comandos disponibles
make help
```

### Testing

```bash
# Ejecutar todos los tests
pytest

# Tests específicos
pytest tests/integration/
pytest tests/unit/

# Con cobertura
pytest --cov=bbe_sdk --cov-report=html
```

### Dependencias

#### Producción

- `numpy` - Manipulación de arrays
- `protobuf>=3.20` - Serialización de datos
- `grpcio` - Comunicación gRPC
- `pika` - Cliente RabbitMQ
- `requests` - HTTP requests
- `pydantic` - Validación de datos

#### Desarrollo

- `pytest` - Framework de testing
- `pytest-asyncio` - Soporte para async/await
- `pytest-cov` - Cobertura de código
- `black` - Formateador de código
- `flake8` - Linter
- `mypy` - Type checker

## Licencia

MIT License - Ver archivo LICENSE para más detalles.

## Soporte

Para soporte técnico o reportar bugs, contactar al equipo de desarrollo.
